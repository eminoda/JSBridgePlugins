(()=>{"use strict";var e,r,o,t={431:(e,r,o)=>{o.r(r),o.d(r,{start:()=>q});const t=require("url");var s=o.n(t);const n=require("address"),i=require("portfinder");var d=o.n(i),a=o(758);const u=require("socket.io");var c=o(435);const p={warning(...e){console.log(c.Ay.yellow(...e))},info(...e){console.log(c.Ay.blue(...e))},debug(...e){console.log(c.Ay.cyan(...e))},error(...e){console.log(c.Ay.red(...e))}},l=o(928),f=o(252),g=f();g.use(f.static(l.join(__dirname,"../public"),{extensions:["html","js","css"]}));const q=async function(e={}){const{url:r,port:o}=await(async(e=3300)=>{d().setBasePort(e);const r=await d().getPortPromise(),o=a.sL();return{url:s().format({protocol:"http",hostname:(0,n.ip)(o.int),port:r,pathname:""}),port:r}})(e.port),t=g.listen(o,(async()=>{(async(e,r)=>{const o=[],t=[],s=e=>{const r=o.findIndex((r=>r.id===e.id));-1===r?o.push(e):o.splice(r,1)},n=new u.Server(e,{cors:{origin:r}});n.disconnectSockets(),n.on("connection",(async e=>{const r=e.handshake.address,n=e.handshake.query.type;p.info(`[${e.id}][${n}] 已连接：${r}`),s(e),e.on("disconnect",(o=>{p.warning(`[${e.id}][${n}] 断开连接：${r}，${o}`),s(e)})),e.on("socket-list",(r=>{const t=o.filter((e=>e.handshake.query.type===r)).map((e=>e.id));p.debug(`[${e.id}][${r}] 列表：${t}`),e.emit("socket-list",t)})),e.on("mock-send",(({seqId:r,jsBridgeSocketId:s,data:n})=>{const i=o.find((e=>e.id===s));if(i)return p.debug(`[${r}][${e.id} to ${s}] --\x3e`,JSON.stringify(n)),t.push({seqId:r,socketId:e.id}),void i.emit("server-send",{seqId:r,data:n});p.error(`[${s}] JSBridgeSocket 不存在`)})),e.on("jsbridge-send",(({seqId:r,data:s})=>{const n=t.find((e=>e.seqId===r))?.socketId;if(n){const t=o.find((e=>e.id===n));if(t)return p.debug(`[${r}][${e.id} to ${n}] <--`,JSON.stringify(s)),void t.emit("mock-send",{seqId:r,data:s})}p.error(`[${n}] MockSocket 不存在`)}))}))})(t,e.origin),p.info("JSBridge Server running at:",r)}))}},746:e=>{e.exports=require("cross-spawn")},252:e=>{e.exports=require("express")},571:e=>{e.exports=require("get-stream")},967:e=>{e.exports=require("merge-stream")},769:e=>{e.exports=require("path-key")},919:e=>{e.exports=require("signal-exit")},573:e=>{e.exports=require("node:buffer")},421:e=>{e.exports=require("node:child_process")},24:e=>{e.exports=require("node:fs")},30:e=>{e.exports=require("node:net")},161:e=>{e.exports=require("node:os")},760:e=>{e.exports=require("node:path")},708:e=>{e.exports=require("node:process")},66:e=>{e.exports=require("node:tty")},136:e=>{e.exports=require("node:url")},975:e=>{e.exports=require("node:util")},928:e=>{e.exports=require("path")}},s={};function n(e){var r=s[e];if(void 0!==r)return r.exports;var o=s[e]={exports:{}};return t[e](o,o.exports,n),o.exports}n.m=t,n.x=()=>{var e=n.O(void 0,[121],(()=>n(431)));return n.O(e)},e=[],n.O=(r,o,t,s)=>{if(!o){var i=1/0;for(c=0;c<e.length;c++){for(var[o,t,s]=e[c],d=!0,a=0;a<o.length;a++)(!1&s||i>=s)&&Object.keys(n.O).every((e=>n.O[e](o[a])))?o.splice(a--,1):(d=!1,s<i&&(i=s));if(d){e.splice(c--,1);var u=t();void 0!==u&&(r=u)}}return r}s=s||0;for(var c=e.length;c>0&&e[c-1][2]>s;c--)e[c]=e[c-1];e[c]=[o,t,s]},n.n=e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return n.d(r,{a:r}),r},n.d=(e,r)=>{for(var o in r)n.o(r,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:r[o]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce(((r,o)=>(n.f[o](e,r),r)),[])),n.u=e=>"vendor.js",n.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o={57:1},n.O.require=e=>o[e],n.f.require=(e,r)=>{o[e]||(e=>{var r=e.modules,t=e.ids,s=e.runtime;for(var i in r)n.o(r,i)&&(n.m[i]=r[i]);s&&s(n);for(var d=0;d<t.length;d++)o[t[d]]=1;n.O()})(require("./"+n.u(e)))},r=n.x,n.x=()=>(n.e(121),r());var i=n.x(),d=exports;for(var a in i)d[a]=i[a];i.__esModule&&Object.defineProperty(d,"__esModule",{value:!0})})();